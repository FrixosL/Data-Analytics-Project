---
title: "Group Assignment"
author: "Frixos Larkos"
date: "09/10/2019"
output: html_document
---

```{r huxtable-stuff, include=FALSE}
options("huxtable.knit_print_df" = FALSE)
library(lubridate)
library(here)
library(moderndive)
library(tidyverse)
library(ggfortify)
library(infer)
library(mosaic)
library(huxtable)
library(kableExtra)
library(tidyquant)
library(readxl) #need to load readxl explicitly, as it is not a core tidyverse 
library(GGally)
library(broom)
library(scales)
# library(plotly) # Animation of graphs and tables
# library(DT) 
```

# Explanatory Data Analysis (EDA)

```{r load_data}

raw_data <- read_csv(here::here('Data', 'listings.csv.gz'))

```


## Looking at raw values

```{r EDA}

glimpse(raw_data)

```

## Looking at summary statistics

```{r summary_stats}

mosaic::favstats(price ~ city, data = raw_data)

skimr::skim(raw_data)

```

## Cleaning Data

```{r clean_data}

clean_data <- raw_data %>% 
  filter()

# Code written by Noel below

# Summary
glimpse(airbnb)

# 1.1 Data Wrangling
airbnb <- airbnb %>% 
  extract(price, "price") %>%
  mutate(price = as.numeric(price))

airbnb <- airbnb %>% 
  extract(weekly_price, "weekly_price") %>%
  mutate(weekly_price = as.numeric(weekly_price))

airbnb <- airbnb %>% 
  extract(monthly_price, "monthly_price") %>%
  mutate(monthly_price = as.numeric(monthly_price))

airbnb <- airbnb %>% 
  extract(cleaning_fee, "cleaning_fee") %>%
  mutate(cleaning_fee = as.numeric(cleaning_fee))

airbnb <- airbnb %>% 
  extract(extra_people, "extra_people") %>%
  mutate(extra_people = as.numeric(extra_people))

airbnb <- airbnb %>% 
  extract(security_deposit, "security_deposit") %>%
  mutate(security_deposit = as.numeric(security_deposit))

# 1.2 Missing values
airbnb <- airbnb %>%
  mutate(cleaning_fee = case_when(
    is.na(cleaning_fee) ~ 0, 
    TRUE ~ cleaning_fee
  ))


# Frequency analysis of property types

airbnb_sorted <- airbnb %>% 
  group_by(property_type) %>% 
  summarize("Count" = n()) %>% 
  arrange(desc(Count))

airbnb_sorted %>% 
  head(4)

# Property type simplified column added

airbnb <- airbnb %>%
  mutate(prop_type_simplified = case_when(
    property_type %in% c("Apartment","Serviced apartment", "Loft","House") ~ property_type, 
    TRUE ~ "Other"
  ))

airbnb %>%
  count(property_type, prop_type_simplified) %>%
  arrange(desc(n))  


```


**Answer at minimum**: 
*1. How many variables/columns? How many rows/observations?* 

There are 106 variables and 19833 observations

*2. Which variables are numbers?*

(skim table - numeric)

3. Which are categorical or factor variables (numeric or character variables with variables that have a fixed and known set of possible values?

?

4. What are the correlations between variables? 


5. Does each scatterplot support a linear relationship between variables?

6. Do any of the correlations appear to be conditional on the value of a categorical variable?

##  Visualisations

```{r visualizations, echo=TRUE, message=FALSE, warning=FALSE}

raw_data %>%
  #mutate(host_is_superhost = case_when(
    #host_is_superhost %in% TRUE ~ superhost, FALSE ~ non_superhost, NA)) %>%
  select(host_is_superhost, price, review_scores_rating) %>%
  na.omit() %>%
  ggpairs(aes(colour = host_is_superhost, alpha = 0.3)) +
  theme_bw() 

```


# Mapping

```{r MAP, echo=TRUE, message=FALSE, warning=FALSE}

library(leaflet)

leaflet(data = filter(raw_data, minimum_nights <= 4)) %>% 
  addProviderTiles("OpenStreetMap.Mapnik") %>% 
  addCircleMarkers(lng = ~longitude, 
                   lat = ~latitude, 
                   radius = 1, 
                   fillColor = "blue", 
                   fillOpacity = 0.4, 
                   popup = ~listing_url,
                   label = ~property_type)

```

# Regressions